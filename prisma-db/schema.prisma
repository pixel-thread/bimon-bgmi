// ─────────────────────────────────────
// AUTO-GENERATED FROM PRODUCTION DATABASE
// This schema matches the ACTUAL database structure.
// DO NOT run `prisma migrate` with this schema — it is read-only.
// ─────────────────────────────────────

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ─────────────────────────────────────
// ENUMS (from actual DB)
// ─────────────────────────────────────

enum Role {
  SUPER_ADMIN
  ADMIN
  PLAYER
  USER
}

enum SeasonStatus {
  ACTIVE
  INACTIVE
}

enum PlayerCategory {
  ULTRA_NOOB
  NOOB
  PRO
  ULTRA_PRO
  BOT
  LEGEND
}

enum Vote {
  IN
  OUT
  SOLO
}

enum TeamType {
  SOLO
  DUO
  TRIO
  SQUAD
  DYNAMIC
}

enum Status {
  ACTIVE
  INACTIVE
  DELETED
}

enum GalleryStatus {
  ACTIVE
  INACTIVE
}

enum UCTransferStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum UCTransferType {
  REQUEST
  SEND
}

enum ReferralStatus {
  PENDING
  QUALIFIED
  PAID
}

enum JobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum JobType {
  CREATE_TEAMS_BY_POLL
}

// ─────────────────────────────────────
// CORE IDENTITY
// ─────────────────────────────────────

model User {
  id                      String    @id @default(uuid())
  email                   String?   @unique
  clerkId                 String    @unique
  isEmailLinked           Boolean   @default(false)
  userName                String    @unique
  usernameLastChangeAt    DateTime  @default(now())
  role                    Role      @default(USER)
  balance                 Int       @default(0)
  isInternal              Boolean   @default(false)
  isVerified              Boolean   @default(false)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  playerId                String?
  ucId                    String?
  createdBy               String?
  isOnboarded             Boolean   @default(true)
  displayName             String?
  dateOfBirth             DateTime?
  isPromoter              Boolean   @default(false)
  promoterEarnings        Int       @default(0)
  referralCode            String?   @unique
  displayNameLastChangeAt DateTime?
  imageUrl                String?

  // Relations
  player         Player?
  referralsGiven Referral[] @relation("PromoterReferrals")

  @@index([isOnboarded])
}

model Player {
  id                    String          @id @default(uuid())
  isBanned              Boolean         @default(false)
  userId                String          @unique
  user                  User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  characterImageId      String?         @unique
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  pollId                String?
  playerPollVoteId      String?
  ucId                  String?
  category              PlayerCategory  @default(NOOB)
  playerBannedId        String?
  isUCExempt            Boolean         @default(false)
  isTrusted             Boolean         @default(false)
  isSoloRestricted      Boolean         @default(false)
  meritScore            Int             @default(100)
  soloMatchesNeeded     Int             @default(0)
  lastStreakRewardAt    DateTime?
  lastTournamentSeqId  Int?
  tournamentStreak     Int             @default(0)
  streakSeasonId       String?
  customProfileImageUrl String?
  pendingStreakReward   Int?
  pendingWinnerDetails Json?
  pendingWinnerPosition Int?
  pendingWinnerReward  Int?
  pendingWinnerTournament String?
  pendingReferralBonus Int?
  pendingReferralMsg   String?
  pendingSoloSupport   Int?
  pendingSoloSupportMsg String?
  bio                  String?

  // Relations
  characterImage    Gallery?            @relation(fields: [characterImageId], references: [id], onDelete: SetNull)
  poll              Poll?               @relation(fields: [pollId], references: [id])
  seasons           Season[]            @relation("PlayerSeason")
  playerStats       PlayerStats[]
  teams             Team[]              @relation("PlayerToTeam")
  matches           Match[]             @relation("MatchToPlayer")
  pollVotes         PlayerPollVote[]
  matchesPlayed     MatchPlayerPlayed[]
  teamStats         TeamStats[]         @relation("PlayerToTeamStats")
  teamPlayerStats   TeamPlayerStats[]
  transactions      Transaction[]
  ucTransfersFrom   UCTransfer[]        @relation("UCTransferFrom")
  ucTransfersTo     UCTransfer[]        @relation("UCTransferTo")
  pushSubscriptions PushSubscription[]
  playerBanned      PlayerBanned?
  jobListing        PlayerJobListing?
  meritRatingsGiven    PlayerMeritRating[] @relation("MeritGiven")
  meritRatingsReceived PlayerMeritRating[] @relation("MeritReceived")
  referral          Referral?
  royalPasses       RoyalPass[]
  notifications     Notification[]
  gameScores        GameScore[]
  uc                UC?
  jobReactions      JobListingReaction[]

  @@index([userId])
  @@index([category])
}

// ─────────────────────────────────────
// ECONOMY
// ─────────────────────────────────────

model UC {
  id        String   @id @default(uuid())
  balance   Int      @default(0)
  playerId  String   @unique
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

model UCTransfer {
  id              String           @id @default(uuid())
  amount          Int
  type            UCTransferType
  status          UCTransferStatus @default(PENDING)
  message         String?
  fromPlayerId    String
  toPlayerId      String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  responseMessage String?

  fromPlayer Player @relation("UCTransferFrom", fields: [fromPlayerId], references: [id], onDelete: Cascade)
  toPlayer   Player @relation("UCTransferTo", fields: [toPlayerId], references: [id], onDelete: Cascade)

  @@index([fromPlayerId])
  @@index([toPlayerId])
  @@index([status])
}

model Transaction {
  id          String   @id @default(uuid())
  amount      Int
  description String
  playerId    String
  timestamp   DateTime @default(now())
  type        String

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
}

// ─────────────────────────────────────
// PLAYER TRACKING
// ─────────────────────────────────────

model PlayerBanned {
  id          String    @id @default(uuid())
  banReason   String?   @default("")
  bannedAt    DateTime?
  banDuration Int       @default(0)
  playerId    String    @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

model PlayerMeritRating {
  id           String @id @default(uuid())
  fromPlayerId String
  toPlayerId   String
  rating       Int
  tournamentId String
  createdAt    DateTime @default(now())
  seasonId     String?

  fromPlayer Player @relation("MeritGiven", fields: [fromPlayerId], references: [id], onDelete: Cascade)
  toPlayer   Player @relation("MeritReceived", fields: [toPlayerId], references: [id], onDelete: Cascade)

  @@unique([fromPlayerId, toPlayerId, tournamentId])
  @@index([toPlayerId])
  @@index([tournamentId])
  @@index([seasonId])
}

// ─────────────────────────────────────
// SEASONS & TOURNAMENTS
// ─────────────────────────────────────

model Season {
  id          String       @id @default(uuid())
  name        String
  description String?
  startDate   DateTime
  endDate     DateTime?
  status      SeasonStatus @default(ACTIVE)
  createdBy   String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  players           Player[]            @relation("PlayerSeason")
  playerStats       PlayerStats[]
  tournaments       Tournament[]
  teams             Team[]
  matches           Match[]
  teamStats         TeamStats[]
  teamPlayerStats   TeamPlayerStats[]
  matchPlayerPlayed MatchPlayerPlayed[]
  royalPasses       RoyalPass[]

  @@index([status])
  @@index([startDate, endDate])
}

model Tournament {
  id               String   @id @default(uuid())
  name             String
  description      String?
  startDate        DateTime @default(now())
  endDate          DateTime?
  fee              Int?
  seasonId         String?
  createdBy        String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  status           Status   @default(ACTIVE)
  isWinnerDeclared Boolean  @default(false)
  galleryId        String?

  season  Season?  @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  gallery Gallery? @relation(fields: [galleryId], references: [id], onDelete: SetNull)

  teams             Team[]
  matches           Match[]
  winners           TournamentWinner[]
  teamStats         TeamStats[]
  poll              Poll?
  recentMatchGroups RecentMatchGroup[]
  matchPlayerPlayed MatchPlayerPlayed[]
  income            Income[]
  sequence          TournamentSequence?

  @@index([seasonId])
  @@index([status])
  @@index([startDate])
}

model Match {
  id           String  @id @default(uuid())
  name         Int     @default(autoincrement())
  tournamentId String
  seasonId     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tournament        Tournament          @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  season            Season?             @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  teams             Team[]              @relation("MatchToTeam")
  players           Player[]            @relation("MatchToPlayer")
  playerStats       PlayerStats[]       @relation("MatchToPlayerStats")
  teamStats         TeamStats[]
  teamPlayerStats   TeamPlayerStats[]
  matchPlayerPlayed MatchPlayerPlayed[]

  @@index([tournamentId])
  @@index([seasonId])
}

model TournamentWinner {
  id            String  @id @default(uuid())
  amount        Int     @default(0)
  position      Int
  teamId        String  @unique
  tournamentId  String
  createdAt     DateTime @default(now())
  isDistributed Boolean  @default(false)

  team       Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)
  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, teamId])
}

model TournamentSequence {
  id           String @id @default(uuid())
  tournamentId String @unique
  sequenceId   Int    @unique @default(autoincrement())
  createdAt    DateTime @default(now())

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@index([sequenceId])
}

// ─────────────────────────────────────
// TEAMS & STATS
// ─────────────────────────────────────

model Team {
  id           String   @id @default(uuid())
  name         String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  teamNumber   Int
  tournamentId String?
  seasonId     String?

  tournament        Tournament?         @relation(fields: [tournamentId], references: [id], onDelete: SetNull)
  season            Season?             @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  players           Player[]            @relation("PlayerToTeam")
  matches           Match[]             @relation("MatchToTeam")
  teamStats         TeamStats[]
  playerStats       PlayerStats[]       @relation("PlayerStatsToTeam")
  teamPlayerStats   TeamPlayerStats[]
  matchPlayerPlayed MatchPlayerPlayed[]
  tournamentWinner  TournamentWinner[]

  @@index([tournamentId])
  @@index([seasonId])
}

model TeamStats {
  id           String   @id @default(uuid())
  matchId      String
  seasonId     String?
  tournamentId String?
  teamId       String
  position     Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  match           Match             @relation(fields: [matchId], references: [id], onDelete: Cascade)
  team            Team              @relation(fields: [teamId], references: [id], onDelete: Cascade)
  season          Season?           @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  tournament      Tournament?       @relation(fields: [tournamentId], references: [id], onDelete: SetNull)
  playersStats    PlayerStats[]     @relation("PlayerStatsToTeamStats")
  players         Player[]          @relation("PlayerToTeamStats")
  teamPlayerStats TeamPlayerStats[]

  @@unique([teamId, matchId])
  @@index([matchId])
  @@index([seasonId])
  @@index([tournamentId])
  @@index([teamId])
}

model TeamPlayerStats {
  id          String   @id @default(uuid())
  playerId    String
  teamId      String
  matchId     String
  kills       Int      @default(0)
  deaths      Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  seasonId    String?
  teamStatsId String

  player    Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  team      Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  match     Match     @relation(fields: [matchId], references: [id], onDelete: Cascade)
  teamStats TeamStats @relation(fields: [teamStatsId], references: [id], onDelete: Cascade)
  season    Season?   @relation(fields: [seasonId], references: [id], onDelete: SetNull)

  @@unique([playerId, teamId, matchId])
  @@index([playerId])
  @@index([teamId])
  @@index([matchId])
  @@index([teamStatsId])
}

model PlayerStats {
  id       String   @id @default(uuid())
  playerId String
  deaths   Int      @default(0)
  kills    Int      @default(0)
  seasonId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player    Player      @relation(fields: [playerId], references: [id], onDelete: Cascade)
  season    Season?     @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  teamStats TeamStats[] @relation("PlayerStatsToTeamStats")
  teams     Team[]      @relation("PlayerStatsToTeam")
  matches   Match[]     @relation("MatchToPlayerStats")

  @@unique([seasonId, playerId])
  @@index([seasonId])
  @@index([playerId])
}

model MatchPlayerPlayed {
  id           String   @id @default(uuid())
  matchId      String
  playerId     String
  tournamentId String
  seasonId     String?
  teamId       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  match      Match      @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player     Player     @relation(fields: [playerId], references: [id], onDelete: Cascade)
  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  season     Season?    @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  team       Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([playerId, seasonId, createdAt(sort: Desc)])
  @@index([teamId, tournamentId])
  @@index([tournamentId])
}

// ─────────────────────────────────────
// POLLS & VOTING
// ─────────────────────────────────────

model Poll {
  id           String    @id @default(uuid())
  startDate    DateTime  @default(now())
  isActive     Boolean   @default(true)
  days         String    @default("Monday")
  endDate      DateTime?
  question     String
  tournamentId String    @unique
  createdAt    DateTime  @default(now())
  teamType     TeamType  @default(DUO)
  luckyVoterId String?

  tournament Tournament       @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  options    PollOption[]
  votes      PlayerPollVote[]
  players    Player[]
}

model PollOption {
  id         String   @id @default(uuid())
  name       String
  vote       Vote
  pollVoteId String
  createdAt  DateTime @default(now())

  poll Poll @relation(fields: [pollVoteId], references: [id], onDelete: Cascade)
}

model PlayerPollVote {
  id       String   @id @default(uuid())
  playerId String
  vote     Vote
  createdAt DateTime @default(now())
  pollId   String

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  poll   Poll   @relation(fields: [pollId], references: [id], onDelete: Cascade)

  @@unique([playerId, pollId])
}

// ─────────────────────────────────────
// NOTIFICATIONS
// ─────────────────────────────────────

model Notification {
  id        String   @id @default(uuid())
  title     String
  message   String
  isRead    Boolean  @default(false)
  type      String
  link      String?
  playerId  String
  createdAt DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId, isRead])
}

model PushSubscription {
  id       String   @id @default(uuid())
  endpoint String   @unique
  p256dh   String
  auth     String
  playerId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
}

// ─────────────────────────────────────
// MEDIA & GALLERY
// ─────────────────────────────────────

model Gallery {
  id                 String        @id @default(uuid())
  imageId            String        @unique
  name               String
  path               String
  fullPath           String
  publicUrl          String
  status             GalleryStatus @default(ACTIVE)
  isCharacterImg     Boolean       @default(false)
  playerId           String?       @unique
  isGlobalBackground Boolean       @default(false)
  isAnimated         Boolean       @default(false)
  thumbnailUrl       String?
  isVideo            Boolean       @default(false)

  player      Player?
  tournaments Tournament[]
}

model RecentMatchGroup {
  id              String   @id @default(uuid())
  tournamentId    String
  tournamentTitle String
  deletionMarker  Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  tournament Tournament        @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  images     RecentMatchImage[]

  @@index([deletionMarker])
  @@index([tournamentId])
}

model RecentMatchImage {
  id          String   @id @default(uuid())
  matchNumber Int
  imageUrl    String
  imagePath   String
  groupId     String
  createdAt   DateTime @default(now())

  group RecentMatchGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@index([matchNumber])
}

// ─────────────────────────────────────
// FINANCE
// ─────────────────────────────────────

model Income {
  id             String      @id @default(uuid())
  amount         Float
  description    String
  tournamentId   String?
  tournamentName String?
  parentId       String?
  isSubIncome    Boolean     @default(false)
  createdBy      String
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  tournament Tournament? @relation(fields: [tournamentId], references: [id], onDelete: SetNull)
  parent     Income?     @relation("IncomeChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children   Income[]    @relation("IncomeChildren")

  @@index([tournamentId])
  @@index([parentId])
  @@index([createdAt])
}

// ─────────────────────────────────────
// REFERRALS & ROYAL PASS
// ─────────────────────────────────────

model Referral {
  id                   String         @id @default(uuid())
  promoterId           String
  referredPlayerId     String         @unique
  status               ReferralStatus @default(PENDING)
  tournamentsCompleted Int            @default(0)
  qualifiedAt          DateTime?
  paidAt               DateTime?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt

  promoter       User   @relation("PromoterReferrals", fields: [promoterId], references: [id], onDelete: Cascade)
  referredPlayer Player @relation(fields: [referredPlayerId], references: [id], onDelete: Cascade)

  @@index([promoterId])
  @@index([status])
}

model RoyalPass {
  id           String   @id @default(uuid())
  playerId     String
  createdAt    DateTime @default(now())
  amount       Int
  displayValue Int
  pricePaid    Int
  promoCode    String?
  seasonId     String?

  player Player  @relation(fields: [playerId], references: [id], onDelete: Cascade)
  season Season? @relation(fields: [seasonId], references: [id], onDelete: SetNull)

  @@index([playerId])
  @@index([seasonId])
  @@index([createdAt])
}

// ─────────────────────────────────────
// JOBS & LISTINGS
// ─────────────────────────────────────

model PlayerJobListing {
  id             String   @id @default(uuid())
  playerId       String   @unique
  category       String
  customCategory String?
  title          String   @db.VarChar(50)
  description    String?  @db.VarChar(150)
  phoneNumber    String
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  category2      String?
  dislikeCount   Int      @default(0)
  experience     String?
  isJobBanned    Boolean  @default(false)
  likeCount      Int      @default(0)
  availability   String?
  location       String?  @db.VarChar(50)
  imageUrls      String[]
  workingHours   Json?

  player    Player               @relation(fields: [playerId], references: [id], onDelete: Cascade)
  reactions JobListingReaction[]
}

model JobListingReaction {
  id           String   @id @default(uuid())
  listingId    String
  playerId     String
  reactionType String
  createdAt    DateTime @default(now())

  listing PlayerJobListing @relation(fields: [listingId], references: [id], onDelete: Cascade)
  player  Player           @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([listingId])
  @@index([playerId])
}

// ─────────────────────────────────────
// GAME SCORES
// ─────────────────────────────────────

model GameScore {
  highScore    Int
  lastPlayedAt DateTime
  playerId     String

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@id([playerId])
  @@index([playerId])
}

// ─────────────────────────────────────
// MISC
// ─────────────────────────────────────

model Rule {
  id        String   @id @default(uuid())
  title     String
  content   String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String
}

model SoloTaxPool {
  id        String   @id @default(uuid())
  amount    Int      @default(0)
  seasonId  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  donorName String?

  @@index([seasonId])
}
